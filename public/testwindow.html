<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="icon"
          href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ¯</text></svg>">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Window</title>
    <script>
        function appendDataToBody(data) {
            const script = document.createElement('script')
            script.type = 'application/json'
            script.textContent = data;
            document.body.appendChild(script)
        }

        async function callPipe(data) {
            await PD[data.pipe](data.inputs)
                    .then(result => {
                        window.opener && window.opener.postMessage(JSON.stringify({
                            pipe: data.pipe,
                            server: data.inputs.server,
                            result: result
                        }), '*')
                        appendDataToBody(JSON.stringify(result, null, 2))
                        if ('html' in result) {
                            document.body.innerHTML = result.html
                        }
                    })
        }
    </script>
    <script src="/scripts/pdglobal.client.js"></script>
    <script>
        const PDGLOBAL_KEY = 'pdglobal'
        window.addEventListener('message', async function (e) {
            const data = JSON.parse(e.data)
            localStorage.setItem(PDGLOBAL_KEY, e.data)
            await callPipe(data)
        })

        if (localStorage.getItem(PDGLOBAL_KEY)) {
            const data = JSON.parse(localStorage.getItem(PDGLOBAL_KEY))
            !data.inputs.server && callPipe(data)
        }
    </script>
    <style>
        body {
            min-height: 100vh; /* Ensures the container takes up the full viewport height */
            width: 100%; /* Ensures the container takes up the full viewport height */
        }

        body > div {
            min-height: 100vh; /* Ensures the container takes up the full viewport height */
            width: 100%; /* Ensures the container takes up the full viewport height */
        }
    </style>
</head>
<body><strong>Proving Ground</strong></body>
</html>
